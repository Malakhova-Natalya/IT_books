# Ralph Kimball, Margy Ross "The Data Warehouse Toolkit. The Definitive Guide to Dimensional Modeling" (Third Edition) 

## Chapter 2 

## Kimball Dimensional Modeling Techniques Overview /<br> Обзор методов размерного моделирования Кимбалла


Содержание:
- [Fundamental Concepts](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#fundamental-concepts) *(Основные понятия)*

- [Basic Fact Table Techniques](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball,%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#basic-fact-table-techniques) *(Основные методы составления таблиц фактов)*

- [Basic Dimensional Table Techniques](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#basic-dimensional-table-techniques) *(Основные методы работы с размерными таблицами)*

- [Integration via Conformed Dimensions](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#integration-via-conformed-dimensions) *(Интеграция посредством конформных размеров)*

- [Dealing with Slowly Changing Dimension Attributes](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#dealing-with-slowly-changing-dimension-attributes) *(Работа с медленно изменяющимися атрибутами измерений)*

- [Dealing with Dimension Hierarchies](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#dealing-with-dimension-hierarchies) *(Работа с иерархиями измерений)*

- [Advanced Fact Table Techniques](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#advanced-fact-table-techniques) *(Передовые методы составления таблиц фактов)*

- [Advanced Dimension Techniques](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#advanced-dimension-techniques) *(Передовые методы измерения)*
- [Special Purpose Schemas](https://github.com/Malakhova-Natalya/IT_books/blob/main/all_books/Ralph%20Kimball%2C%20Margy%20Ross%20-%20The%20Data%20Warehouse%20Toolkit/contents/chapter_02/README.md#special-purpose-schemas) *(Схемы специального назначения)*


Поначалу, со времен первого издания (1996), группа Кимбалла определила набор техник многомерного моделирования. Авторы чувствовали, что эти техники нужно представить через примеры знакомых кейсов различных индустрий. Они и до сих пор считают это хорошим педагогическим подходом. Но с тех пор эти техники стали настолько стандартизированы, что многие архитекторы начинают с техник, а затем уже переходят к примерам использования.

Техники Кимбалла были широко распространены в индустрии. В качестве доказательства, некоторые бывшие студенты университета Кимбалла выпустили свои собственные книги. Но эти книги не расширили библиотеку техник в значительной мере и не создали конфликтующих разборов (только объясняли техники Кимбалла более точно и подробно).

Эта глава - "официальный" набор техник от создателей этих паттернов моделирования.

### Fundamental Concepts  
***(Основные понятия)***

Техники этого раздела должны рассматриваться в течение разработки каждого дизайна многомерного моделирования.

**Сбор бизнес-требований и реалий данных**

Перед моделированием команде нужно понять:
- как нужды бизнеса,
- так и реалии исходных данных.

Вы поймёте требования при помощи сессий с бизнес-заказчиками, направленных на раскрытие их целей KPI (key performance indicators - ключевые показатели эффективности), ключевых деловых запросов, процессов по принятию решений и поддержке аналитических нужд.

В то же время реалии исходных данных вы поймёте при помощи встреч с экспертами исходных систем и при помощи высокоуровневого профилирования данных для оценки их пригодности к использованию.

**Семинары по совместному многомерному моделированию**

Модели многомерного моделирования данных должны разрабатываться совместно с ключевыми экспертами в областях и представителями бизнеса по управлению данными. Модельер данных отвечает за разработку, однако модели должны быть раскрыты при помощи интерактивных семинаров с представителями бизнеса. Эти семинары даюь дополнительную возможность дополнить бизнес-требования.

Многомерные модели не должны разработаться изолированно людьми, которые не полностью понимают бизнес и его нужды, взаимодействие с бизнесом критически важно.

**Четырех-ступенчатый процесс**

4 ключевые решения, совершаемых в течение моделирования, включают:
1. выбор бизнес-процесса
2. определение гранулярности
3. идентификация измерений
4. идентификация фактов

Благодаря этим шагам, команда дизайна моделирования определяет таблицу и названия столбцов, набор значений домена, бизнес-правила. Представители управления данными должны участвовать в этой детализирующей активности, чтобы обеспечить поддержку со стороны бизнеса.

**Бизнес-процессы**

Бизнес-процессы это опреационные активности, совершаемые вашей организацией (взятие заказа, регистрация студентов и т.п.). События бизнес-процессов генерируют метрики производительности, которые транслируются в факты в таблице фактов. Большинство таблиц фактов фокусируются на каком-то одном бизнес-процессе. Выбор процесса важен, потому что это определяет специфическую цель дизайна, позволяет гранулярности, измерениям и фактам быть декларированными. Каждый бизнес-процесс соответствует строке в матрице хранилища данных.

**Гранулярность**

Определение гранулярности - ключевой шаг в многомерном моделировании. Гранулярность устанавливает, что представлет собой одна строка в таблице. Это становится договорённостью, связывающей весь дизайн. Гранулярность должна быть определена до выбора измерений или фактов. Эта последовательность усиливает унификацию всего многомерного дизайна (что важно для использовавния в BI и для простоты использования).

Атомная гранулярность (atomic grain) относится к нижайшему уровню, на котором данные захвачены бизнес-процессом. Авторы строго рекомендуют начинать фокусироваться на атомной гранулярности, поскольку этот подход впоследствии устоит при возникновении непредсказуемых бизнес-запросов. Каждая предложенная гранулярность таблицы фактов реализуется в отдельной физической таблице. Различная гранулярность не должна смешиваться в одной таблице фактов.

**Измерения (dimensions) для описательного контекста**

Измерения задают "кто, что, где, когда, почему и как" контекст вокруг событий бизнес-процесса. Таблицы измерений содержат описательные атрибуты, используемые BI приложениями для фильтрации и группировки фактов. Имея в виду гранулряность таблицы фактов, можно идентифицировать все возможные измерения. Измерение, всегда, когда это возможно, должно иметь единственное значение при соединении со строкой из таблицы фактов.

Иногда таблицы измерений называют "душой" хранилища данных, потому что они они содержат входные точки и описательные лейблы, способствующие построению DW/BI бизнес-анализу. Диспропорциональное количество усилий прикладывается к управлению и разработке таблиц измерений, потому что они драйверы пользовательского BI опыта.

**Факты для измерений (measurements)**

Факты это такие измерения, которые происходят от событий бизнес-процесса и почти всегда измеряются числами. Отдельно взятая строка таблицы фактов имеет связь 1-к-1 к измеримому событию в соответствии с тем, как оно описано гранулярностью таблицы фактов. Таким образом таблица фактов соответствует физически наблюдаемому событию, а не требованиям конкретного отчёта. Внутри таблицы фактов могут быть только факты, соответствующие заявленной гранулярности.

**Схема звезда и OLAP кубы**

Схема звезда - это структура, развернутая в реляционной системе управления базами данных (`relational database management system (RDBMS)`). Такие структуры, что характерно, состоят из таблиц фактов, связанных с ассоциированными таблицами измерений при помощи связей первичных/внешних ключей (`PK, FK`). Куб онлайн-аналитической обработки (`online analytical processing (OLAP)`) - структура измерений, встроенная в многомерную базу данных. Это может быть эквивалентно (а чаще происходит из) реляционной схеме звезда. OLAP куб содержит атрибуты измерений и факты, но может быть запрошен при помощи языков, имеющих более аналитические возможности, чем SQL (XMLA, MDX). OLAP кубы включены в список базовых техник, т.к. они часто являтся финальным шагом в развертывании dimensional DW/BI системы, или могут существовать как агрегирующая структура, основанная на более детальной (atomic) реляционной схеме звезда.

**Изящные расширения к многомерным моделям**

Многомерные модели устойчивы к  изменениям отношений данных. Все перечисленные ниже изменения могут быть встроены без изменения существующих BI запросов или приложений, и без каких-либо изменений в результататх этих запросов.

- факты, соответствующие гранулряности существующей таблицы фактов, могут быть добавлены при помощи добавления новых столбцов
- измерения могут быть добавлены к существующей таблице фактов при помощи создания столбца с новым внешним ключом (предполагая, что они не изменяют гранулярность таблицы фактов)
- атрибуты могут быть добавлены к существующей таблице измерений при помощи создания новых столбцов
- грануляция таблицы фактов может быть сделана более детальной (atomic) пр ипомощи добавления атрибутов к существующей таблице измерений, и затем при помощи переформулирования таблицы фактов в более детальной грануляции (аккуратно сохраняя существующие наименования столбцов в таблицах фактов и измерений).

### Basic Fact Table Techniques
***(Основные методы составления таблиц фактов)***

**Структура таблицы фактов**

`Fact Table Structure`. Таблица фактов содержит числовые меры, произведенные операционно измеримым событием их реального мира. В самой детальной гранулярности, строка таблицы фактов соответствует измеримому событию и наоборот. Таким образом фундаментальный дизайн таблицы фактов целиком основан на физической активности, и не навеян отчётами, которые могут быть произведены. Вдобавок к числовым мерам, таблица фактов всегда содержит внешние ключи к каждому ассоциированному измерению, необязательные вырожденные ключи измерений и отметки даты/времени. Таблицы фактов - первая цель вычислений и динамических агрегаций, происходящих из запросов.

**Аддитивные, полуаддитивные и неаддитивные факты**

`Additive, Semi-Additive, Non-Additive Facts`
Числовые меры в таблице фактов бывают трех категорий. 

1) наиболее гибкие и полезные факты - полностью аддитивные (`fully additive`). Аддитивные меры могут быть просуммированы сквозь любые измерения, связанные с таблицей фактов.
2) полу-аддитивные (`semi-additive`) меры могут быть просуммированы сквозь некоторые измерения, но не все. Остатки на счёте - общая полу-аддитивная мера.
3) неаддитивные (`non-additive`) меры не могут быть просуммированы вообще. Например, доли. Наиболее хороший подход к таким мерам это, где возможно, хранить полностью аддитивные компоненты.

**Null в таблицах фактов**

`Nulls in Fact Tables`. Меры с пропусками данных (`null`) отлично вписываются в таблицы фактов. Агрегатные функции (`sum, count, min, max, avg`) - правильно обрабатывают такие данные. Но null нужно избегать во внешних ключах, т.к. они автоматически вызовут нарушение ссылочной целостности (`referential integrity violation`). Вместо null во внешнем ключе должна быть дефолтная строка для неопознанных данных.

**Согласованные факты**

`Conformed Facts`. Если одна и та же мера появляется в отдельных таблицах фактов, надо убедиться, что технические определения фактов идентичны. Если раздельные определения фактов соответствуют друг другу, они должны называться одинаково. Если же они несообразны, их следует специально назвать различным образом, предупреждая этим пользователей.

**Транзакционные таблицы фактов**

`Transaction Fact Tables`. Строка в транзакционной таблице фактов соответствует измеримому событию в точке времени и пространства. Таблицы фактов с гранулярностью транзакции - наиболее многомерные и выразительные таблицы фактов. Эта устойчивая размерность даёт наиболее широкие возможности к нарезке и измельчению/препарированию (`slicing and dicing`) данных. Транзакционные таблицы фактов могут быть часто или редко заполненными, поскольку строки появляются, только если событие имело место.

**Периодические сводные таблицы фактов / Таблицы фактов периодических снимков** 

`Periodic Snapshot Fact Tables` - строка в такой таблице подводит итоги многим событиям, случившимся в заданный стандартный период (день, неделя, месяц). Гранулярность - период, не индивидуальные транзакции. Такие таблицы часто содержат  много фактов, поскольку любое измеримое событие, согласующееся с гранулярностью таблицы фактов, допустимо. Такие таблицы фактов плотно заполнены в их внешних ключах, потому что, даже если в заданный период не было активности, строка в такую таблицу всё равно вставляется (0 или null для каждого факта).

**Накопительные таблицы фактов**

`Accumulating Snapshot Fact Tables` - строка в такой таблице подводит итоги событиям, случившимся в прдесказанные шаги между началом и концом процесса. Конвейерные процессы, такие как заполнение заказа, которые имеют определенную стартовую точку, стандартные промежуточные шаги, и определенную конечную точку, могут быть моделированы при помощи такой таблицы. Для такой таблицы характерно постоянное обновление.

**Таблицы фактов без фактов**

`Factless Fact Tables`. Хотя большинство измеримых событий имеют числовой результат, возможно и такое, что событие просто записывает набор размерных сущностей, имеющихся в определенный момент. Для примера, факт посещения студентом занятия в заданный день может не иметь записанного числового факта, но строку с внешними ключами календарного дня, студента, преподавателя, локации, класса. Также таблицы фактов без фактов могут быть использованы для анализа того, что не случилось. Такие запросы всегда имеют две части: таблица без фактов, что содержит все возможные события и таблица активностей, что содержит события, которые случились.

**Агрегированные таблицы фактов или OLAP кубы**

`Aggregate Fact Tables or OLAP Cubes` - это просто числовые свёртывания данных из таблицы фактов, построенные для ускорения производительности запроса. Эти агрегированные данные должны быть доступны BI наряду с детализированными данными таблицы фактов, чтобы во время запроса можно было выбрать нужный уровень детализации данных. Этот процесс, называемый агрегатной навигацией (`aggregate navigation`), должен быть открытым, чтобы каждый автор отчёта, инструмент запросов, BI приложение пожинали одинаковые плоды выгодной производительности. Должным образом созданные наборы агрегатов должны проявлять себя подобно индексам баз данных, которые ускоряют производительность запроса, но напрямую не задаются ни BI приложением, ни бизнес-пользователем. Агрегированные таблицы фактов содержат внешние ключи к уменьшенным соответствующим размерностям (dimensions), так же как агрегированные факты, созданные при помощи суммирования мер из более детальных таблиц фактов. И, наконец, агрегированные OLAP кубы с суммированными мерами часто построены тем же образом, как реляционные агрегаты, но OLAP кубы задуманы для прямого использования бизнес-пользователями.

**Сводные таблицы фактов**

`Consolidated Fact Tables`. Часто удобно комбинировать факты множества процессов вместе в одной сводной таблице фактов, где они могут быть выражены в одинаковой гранулярности. Например, совершенные продажи могут быть комбинированы с прогнозом продаж, для того чтобы задачу сравнения факта и прогноза сделать быстрой и простой, по сравнению со сборкой данных из различных таблиц фактов. Такие таблицы добавляют тяжести ETL процессу, но снимают тяжесть с BI приложений. Такие таблицы должны быть рассмотрены для кросс-процессных метрик, которые часто анализируются вместе.

### Basic Dimensional Table Techniques
***(Основные методы работы с размерными таблицами)***

**Структура таблицы измерений**

`Dimension Table Structure`. Каждая таблица измерений имеет единственный столбец с первичным ключом. Этот первичный ключ встроен как внешний ключ в любую связанную таблицу фактов, где для строки таблицы фактов корректен описательный контекст из таблицы измерений. Таблицы измерений обычно широкие, плоские денормализованные таблицы с множеством низко кардинальных текстовых атрибутов. НАиболее влиятельные атрибуты - подробные описания. Атрибуты таблиц измерений - первая цель ограничений и спецификаций группировки запросов и BI приложений. Описательные лейблы в отчётах - типичные доменные значения атрибутов таблиц измерений.

**Суррогатные ключи измерений**

`Dimension Surrogate Keys`. Таблица измерений создаётся с одним столбцом, служащим уникальным первичным ключом. Этот первичный ключ не может быть натуральным ключом из операционных данных, поскольку будет множество строк для натурального ключа, когда произойдут изменения с течением времени. К тому же, натуральные ключи для измерения могут быть созданы более чем одной системой, и эти натуральные ключи могут не сопоставляться или плохо администрироваться. Системам DW/BI нужен контроль над всеми первичными ключами измерений. Следует создать анонимные числовые первичные ключи для всех измерений. Эти суррогатные ключи измерений - числа, идущие в последовательности, начинающиеся от 1. Измерения времени освобождены от правила суррогатных ключей. Это измерение (высоко предсказуемое и устойчивое) может использовать более значимый первичный ключ.

**Естественные, Долговечные, Сверхъестественные ключи**

`Natural, Durable, and Supernatural Keys`. Натуральные (=естественные) ключи, созданные опреаицонной исходной системой - предмет бизнес-правил за периметром контроля DW/BI системы. Например, номер сотрудника (natural key) может быть изменен, если тот уходит в отставку, а затем повторно принимается на работу. стр 47




### Integration via Conformed Dimensions
***(Интеграция посредством конформных размеров)***

### Dealing with Slowly Changing Dimension Attributes
***(Работа с медленно изменяющимися атрибутами измерений)***

### Dealing with Dimension Hierarchies
***(Работа с иерархиями измерений)***

### Advanced Fact Table Techniques
***(Передовые методы составления таблиц фактов)***

### Advanced Dimension Techniques
***(Передовые методы измерения)***

### Special Purpose Schemas
***(Схемы специального назначения)***
